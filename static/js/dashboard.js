(function(){function a(a){var b=Math.floor;if(a)try{return b(new Date(a).getTime()/1e3)}catch{}}function b(){const b={};p.search.value.trim()&&(b.search=p.search.value.trim()),p.status.value&&(b.status=p.status.value),p.password.value&&(b.passwordSet=p.password.value),p.maxClicks.value&&(b.maxClicksSet=p.maxClicks.value),p.createdAfter.value&&(b.createdAfter=a(p.createdAfter.value)),p.createdBefore.value&&(b.createdBefore=a(p.createdBefore.value));const c=new URLSearchParams;return c.set("page",q.page+""),c.set("pageSize",(p.pageSize.value||q.pageSize)+""),c.set("sortBy",p.sortBy.value||q.sortBy),c.set("sortOrder",p.order.value||q.sortOrder),Object.keys(b).length&&c.set("filter",JSON.stringify(b)),c.toString()}function c(a){p.loading.style.display=a?"block":"none"}function d(){p.list.innerHTML=""}function e(a){return a?window.SmartDatetime?window.SmartDatetime.formatCreated(a):(()=>{try{return new Date(a).toLocaleString()}catch{return"\u2014"}})():"\u2014"}function f(a){return a||0===a?window.SmartDatetime?window.SmartDatetime.formatLastClick(a):(()=>{try{return new Date(1e3*a).toLocaleString()}catch{return"\u2014"}})():"\u2014"}function g(a){return a?(a+"").replace(/^https?:\/\//i,""):""}function h(a){const b=p.tpl.content.firstElementChild.cloneNode(!0),c=b.querySelector(".link-short"),d=b.querySelector(".link-long"),h=b.querySelector(".badge-active"),i=b.querySelector(".badge-inactive"),j=b.querySelector(".badge-password"),k=b.querySelector(".badge-max-clicks"),l=b.querySelector(".badge-private"),m=b.querySelector(".badge-block-bots"),n=b.querySelector(".created-date"),q=b.querySelector(".last-click-date"),r=b.querySelector(".total-clicks-count");return c.textContent=g(o)+(a.alias?a.alias:""),c.href="/"+(a.alias||""),d.textContent=a.long_url||"",d.title=a.long_url||"",n.textContent=e(a.created_at),q.textContent=f(a.last_click),r.textContent=a.total_clicks??"0","ACTIVE"===a.status?(h.style.display="inline-flex",i.style.display="none"):"INACTIVE"===a.status?(h.style.display="none",i.style.display="inline-flex"):(h.style.display="none",i.style.display="none"),a.password_set&&(j.style.display="inline-flex"),"number"==typeof a.max_clicks&&(k.style.display="inline-flex",k.setAttribute("data-tooltip",`Max clicks: ${a.max_clicks}`)),a.private_stats&&(l.style.display="inline-flex"),a.block_bots&&(m.style.display="inline-flex"),b.setAttribute("data-url-data",JSON.stringify(a)),b.style.cursor="pointer",b.classList.add("clickable-row"),b}async function i(){c(!0),p.empty.style.display="none";try{const a=b(),c="function"==typeof window.authFetch?window.authFetch:fetch,e=await c(`/api/v1/urls?${a}`,{credentials:"include"});if(!e.ok)throw new Error("Request failed");const f=await e.json();if(q.page=f.page,q.pageSize=f.pageSize,q.total=f.total,q.hasNext=f.hasNext,q.sortBy=f.sortBy,q.sortOrder=f.sortOrder,d(),!f.items||0===f.items.length)return p.empty.style.display="block",document.getElementById("links-table").style.display="none",void(p.pagination.style.display="none");document.getElementById("links-table").style.display="block";const g=document.createDocumentFragment();for(const a of f.items)g.appendChild(h(a));p.list.appendChild(g),k(),j()}catch(a){d(),p.empty.style.display="block",document.getElementById("links-table").style.display="none"}finally{c(!1)}}function j(){window.attributeTooltips&&window.attributeTooltips.forEach(a=>a.destroy()),window.attributeTooltips=[];const a=document.querySelectorAll(".tooltip-trigger[data-tooltip]");a.forEach(a=>{a.removeAttribute("title");const b=tippy(a,{content:a.getAttribute("data-tooltip"),placement:"top",theme:"dark",animation:"fade",duration:[200,150],delay:[200,0],arrow:!0,hideOnClick:!1,trigger:"mouseenter focus",zIndex:9999});window.attributeTooltips.push(b)})}function k(){const a=Math.max(1,Math.ceil(q.total/q.pageSize));if(1>=a)return void(p.pagination.style.display="none");p.pagination.style.display="flex";const b=(q.page-1)*q.pageSize+1,c=Math.min(q.total,q.page*q.pageSize);p.pagination.innerHTML="";const d=document.createElement("div");d.className="pagination-info",d.textContent=`Showing ${b} to ${c} of ${q.total}`;const e=document.createElement("div");e.className="pagination-controls";const f=document.createElement("button");f.className="btn",f.textContent="Prev",f.disabled=1>=q.page;const g=document.createElement("button");g.className="btn",g.textContent="Next",g.disabled=!q.hasNext,f.addEventListener("click",()=>{1<q.page&&(q.page-=1,i())}),g.addEventListener("click",()=>{q.hasNext&&(q.page+=1,i())}),e.appendChild(f),e.appendChild(g),p.pagination.appendChild(d),p.pagination.appendChild(e)}function l(){q.page=1,i(),p.optionsDropdown&&p.optionsDropdown.classList.remove("show")}const m=window.dashboardConfig?.hostUrl||document.querySelector("[data-host]")?.getAttribute("data-host")||"",n=m.replace(/\/+$/,""),o=n?n+"/":"/",p={search:document.getElementById("f-search"),status:document.getElementById("f-status"),password:document.getElementById("f-password"),maxClicks:document.getElementById("f-maxclicks"),createdAfter:document.getElementById("f-created-after"),createdBefore:document.getElementById("f-created-before"),sortBy:document.getElementById("f-sortby"),order:document.getElementById("f-order"),pageSize:document.getElementById("f-pagesize"),apply:document.getElementById("btn-apply"),reset:document.getElementById("btn-reset"),optionsBtn:document.getElementById("btn-options"),optionsDropdown:document.getElementById("options-dropdown"),loading:document.getElementById("list-loading"),empty:document.getElementById("list-empty"),list:document.getElementById("links-list"),pagination:document.getElementById("pagination"),tpl:document.getElementById("tpl-link-item")};let q={page:1,hasNext:!1,total:0,pageSize:20,sortBy:"last_click",sortOrder:"descending",filters:{}};p.apply.addEventListener("click",l),p.reset.addEventListener("click",function(){for(const a of["search","status","password","maxClicks","createdAfter","createdBefore"])p[a]&&(p[a].value="");p.sortBy&&(p.sortBy.value="last_click"),p.order&&(p.order.value="descending"),document.querySelectorAll(".seg").forEach(a=>{const b=a.getAttribute("data-target"),c=document.getElementById(b),d="f-order"===b?"descending":"";c&&(c.value=d),a.setAttribute("data-active","f-order"===b?"0":"2")}),p.pageSize&&(p.pageSize.value="20"),l()}),p.search.addEventListener("keydown",a=>{"Enter"===a.key&&l()}),p.optionsBtn&&p.optionsBtn.addEventListener("click",function(){if(p.optionsDropdown){const a=p.optionsDropdown.classList.contains("show");a?p.optionsDropdown.classList.remove("show"):p.optionsDropdown.classList.add("show")}}),window.addEventListener("click",a=>{p.optionsDropdown&&a.target!==p.optionsBtn&&!p.optionsBtn.contains(a.target)&&(p.optionsDropdown.contains(a.target)||p.optionsDropdown.classList.remove("show"))}),function(){const a=document.querySelectorAll(".seg");a.forEach(a=>{function b(b){d&&(d.value=b);const c=f.has(b)?f.get(b):0;a.setAttribute("data-active",c+"")}const c=a.getAttribute("data-target"),d=document.getElementById(c),e=Array.from(a.querySelectorAll("button[data-value]")),f=new Map(e.map((a,b)=>[a.getAttribute("data-value"),b]));b(d?d.value:""),e.forEach(a=>a.addEventListener("click",()=>b(a.getAttribute("data-value")||"")))})}(),window.fetchData=i,i()})();