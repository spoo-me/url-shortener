class V2Announcement{constructor(){this.currentStep=1,this.totalSteps=7,this.modalShown=!1,this.autoShowDelay=1e4,this.autoAdvanceInterval=8e3,this.slideTimer=null,this.prefersReducedMotion="undefined"!=typeof window&&window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches||!1,this.confettiPromise=null,this.confettiInstance=null,this.preloadedPreviewImages=new Set,this.init()}init(){const a=()=>{this.showBadge(),setTimeout(()=>{this.modalShown||this.isAnyModalOpen()||this.openModal()},this.autoShowDelay),this.setupEventListeners(),this.setupPreviewTooltips()};window.authCheckComplete?!window.isLoggedIn&&a():document.addEventListener("auth:init",b=>{b.detail.loggedIn||a()})}showBadge(){const a=document.getElementById("v2-badge");a&&(a.style.display="flex")}isAnyModalOpen(){const a=document.getElementById("authModal");if(a&&"flex"===a.style.display)return!0;if("function"==typeof isLandingEditModalOpen&&isLandingEditModalOpen())return!0;const b=document.querySelectorAll(".modal.active");return!!(0<b.length)}setupEventListeners(){const a=document.getElementById("v2-badge");a&&a.addEventListener("click",()=>this.openModal());const b=document.getElementById("v2-modal-overlay");b&&b.addEventListener("click",a=>{a.target===b&&this.closeModal()}),document.addEventListener("keydown",a=>{this.modalShown&&("Escape"===a.key?this.closeModal():"ArrowRight"===a.key?this.nextStep():"ArrowLeft"===a.key&&this.prevStep())});const c=document.querySelectorAll(".v2-next-btn");c.forEach(a=>{a.addEventListener("click",()=>this.nextStep())});const d=document.querySelectorAll(".v2-prev-btn");d.forEach(a=>{a.addEventListener("click",()=>this.prevStep())});const e=document.querySelectorAll(".v2-progress-dot");e.forEach((a,b)=>{a.addEventListener("click",()=>this.showStep(b+1))});const f=document.getElementById("v2-guest-btn");f&&f.addEventListener("click",()=>this.closeModal());const g=document.getElementById("v2-login-btn");g&&g.addEventListener("click",()=>{this.closeModal(),setTimeout(()=>{const a=document.querySelector("[onclick=\"openAuthModal('login')\"]");a?a.click():"function"==typeof openAuthModal&&openAuthModal("login")},300)})}openModal(){if(!this.modalShown){this.modalShown=!0;const a=document.getElementById("v2-modal-overlay");a&&(a.classList.add("active"),document.body.style.overflow="hidden",this.showStep(1),this.preloadPreviewImages(),this.startSlideTimer(),setTimeout(()=>{this.fireConfetti()},400))}}preloadPreviewImages(){if(!this.prefersReducedMotion){const a=document.querySelectorAll(".v2-feature-highlight-item[data-preview-url], .v2-preview-tooltip[data-preview-url]");a.forEach(a=>{const b=a.getAttribute("data-preview-url");if(b&&!this.preloadedPreviewImages.has(b)){const a=new Image;a.src=b,this.preloadedPreviewImages.add(b)}})}}setupPreviewTooltips(){if("ontouchstart"in window)return;let a=document.querySelector(".v2-preview-tooltip-global");a||(a=document.createElement("div"),a.className="v2-preview-tooltip-global",document.body.appendChild(a));const b=document.querySelectorAll(".v2-feature-highlight-item");b.forEach(b=>{const c=b.getAttribute("data-preview-url");c&&(b.addEventListener("mouseenter",()=>{var d=Math.max,e=Math.round;const f=b.closest(".v2-modal-content");if(!f||!f.classList.contains("active"))return;a.style.backgroundImage=`url('${c}')`;const g=b.getBoundingClientRect(),h=320,i=190;let j=e(g.top-i-12),k=e(g.right-e(.15*h));const l=d(document.documentElement.clientWidth||0,window.innerWidth||0);k+h+12>l&&(k=l-h-12),k<12&&(k=12);const m=d(document.documentElement.clientHeight||0,window.innerHeight||0);j<12&&(j=g.bottom+12,j+i+12>m&&(j=d(12,m-i-12))),a.style.left=`${e(k)}px`,a.style.top=`${e(j)}px`,a.classList.add("visible")}),b.addEventListener("mouseleave",()=>{a.classList.remove("visible")}))})}startSlideTimer(){this.prefersReducedMotion||(this.clearSlideTimer(),this.animateProgressForDot(this.currentStep),this.currentStep>=this.totalSteps||(this.slideTimer=setTimeout(()=>{this.modalShown&&(this.nextStep(),this.startSlideTimer())},this.autoAdvanceInterval)))}clearSlideTimer(){this.slideTimer&&(clearTimeout(this.slideTimer),this.slideTimer=null);const a=document.querySelectorAll(".v2-progress-fill");a.forEach(a=>a.remove())}restartSlideTimer(){this.clearSlideTimer(),this.modalShown&&!this.prefersReducedMotion&&setTimeout(()=>this.startSlideTimer(),80)}animateProgressForDot(a){if(!this.prefersReducedMotion){const b=document.querySelectorAll(".v2-progress-dot");b.forEach((b,c)=>{b.style.position="relative";const d=b.querySelector(".v2-progress-fill");if(d&&d.remove(),c+1===a){const a=document.createElement("span");a.className="v2-progress-fill",a.style.position="absolute",a.style.left="0",a.style.top="0",a.style.height="100%",a.style.width="0%",a.style.borderRadius="999px",a.style.background="linear-gradient(90deg, rgba(124,58,237,0.9), rgba(99,102,241,0.9))",a.style.zIndex="0",a.style.transition=`width ${this.autoAdvanceInterval}ms linear`,b.appendChild(a),requestAnimationFrame(()=>{b.clientWidth+"px";a.style.width="100%"})}})}}closeModal(){const a=document.getElementById("v2-modal-overlay");if(a){a.classList.remove("active"),document.body.style.overflow="",localStorage.setItem("v2_announcement_seen","true");const b=document.getElementById("v2-badge");b&&(b.style.display="none")}this.modalShown=!1,this.clearSlideTimer()}showStep(a){if(!(1>a||a>this.totalSteps)){const b=document.querySelectorAll(".v2-modal-content");b.forEach(a=>a.classList.remove("active"));const c=document.getElementById(`v2-step-${a}`);c&&c.classList.add("active"),this.updateProgressDots(a),this.currentStep=a,this.restartSlideTimer()}}updateProgressDots(a){const b=document.querySelectorAll(".v2-progress-dot");b.forEach((b,c)=>{c+1===a?(b.classList.add("active"),this.animateProgressForDot(a)):b.classList.remove("active")})}nextStep(){this.currentStep<this.totalSteps&&this.showStep(this.currentStep+1)}prevStep(){1<this.currentStep&&this.showStep(this.currentStep-1)}fireConfetti(){const a=()=>{const a=this.getConfettiInstance();if(!a)return void console.warn("[V2Announcement] Confetti instance missing even though library is present");const b={origin:{y:.7}},c=(c,d)=>{a({...b,...d,particleCount:Math.floor(200*c)})};c(.25,{spread:26,startVelocity:55}),setTimeout(()=>{c(.2,{spread:60})},100),setTimeout(()=>{c(.35,{spread:100,decay:.91,scalar:.8})},200),setTimeout(()=>{c(.1,{spread:120,startVelocity:25,decay:.92,scalar:1.2})},300),setTimeout(()=>{c(.1,{spread:120,startVelocity:45})},400)},b=()=>"undefined"==typeof confetti?this.confettiPromise?this.confettiPromise:(this.confettiPromise=new Promise((a,b)=>{const c=document.querySelector("script[src*=\"canvas-confetti\"]");if(c)return c.addEventListener("load",()=>a()),void c.addEventListener("error",()=>b(new Error("Failed to load confetti script")));const d=document.createElement("script");d.src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.4/dist/confetti.browser.min.js",d.async=!0,d.addEventListener("load",()=>a()),d.addEventListener("error",()=>b(new Error("Failed to load confetti script"))),document.head.appendChild(d)}),this.confettiPromise):Promise.resolve();b().then(a).catch(a=>{console.warn("[V2Announcement] Confetti library not loaded",a),this.confettiPromise=null})}getConfettiInstance(){if(this.confettiInstance)return this.confettiInstance;if("undefined"==typeof confetti)return null;let a=document.getElementById("v2-confetti-canvas");return a||(a=document.createElement("canvas"),a.id="v2-confetti-canvas",a.style.position="fixed",a.style.top="0",a.style.left="0",a.style.width="100%",a.style.height="100%",a.style.pointerEvents="none",a.style.zIndex="1000000",a.style.inset="0",document.body.appendChild(a)),this.confettiInstance=confetti.create(a,{resize:!0,useWorker:!0}),this.confettiInstance}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{new V2Announcement}):new V2Announcement;